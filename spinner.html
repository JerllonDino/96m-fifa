<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spin to Win</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="./css/spinner-styles.css" rel="stylesheet" type="text/css" />
    <!-- <link rel="stylesheet" href="./css/media-queries.css"> -->
    <link rel="stylesheet" href="./css/spinner-animations.css" />
    <script src="./js/jquery.js"></script>
    <!-- <script src="./js/phaser.js"></script> -->
    <!-- <script src="./js/phaser.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.5/dist/html2canvas.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  </head>
  <body>
    <div id="background-container"></div>
    <div class="row-wrapper">
      <div class="row d-flex justify-content-center">
        <div class="col col-12 col-sm-8 col-md-8 col-lg-6 col-xl-6 col-xxl-4">
          <div class="wrapper">
            <img src="/assets/images/Background.jpg" id="wrapper-bg-image" />
            <div class="content-wrapper d-flex flex-column align-items-center">
              <img
                src="./assets/images/Logo.svg"
                class="mb-4"
                alt=""
                id="logo-img"
              />
              <span class="text-white fw-light header-texts sf-pro-semibold">
                Today Only: Malaysia
              </span>

              <h5 class="text-white mt-1 header-texts sf-pro-heavy">
                Claim (3) Free Spins Below
              </h5>
              <h5 class="text-white header-texts sf-pro-heavy" id="spin-expiry">
                Spin Before
              </h5>

              <div id="spin-countdown-container" class="container mt-2">
                <div class="row d-flex justify-content-center">
                  <div class="col col-8">
                    <div class="row justify-content-center">
                      <div class="spin-countdown px-0 col-3">
                        <div class="timer-number">
                          <img src="/assets/images/Timer.png" />
                          <span class="race-sport" id="timer-day">0</span>
                        </div>
                        <p class="text-white fs-fixed-sm mt-1">Days</p>
                      </div>
                      <div class="spin-countdown px-0 col-3">
                        <div class="timer-number">
                          <img src="/assets/images/Timer.png" />
                          <span class="race-sport" id="timer-hour">0</span>
                        </div>
                        <p class="text-white fs-fixed-sm mt-1">Hours</p>
                      </div>
                      <div class="spin-countdown px-0 col-3">
                        <div class="timer-number">
                          <img src="/assets/images/Timer.png" />
                          <span class="race-sport" id="timer-minutes"></span>
                        </div>
                        <p class="text-white fs-fixed-sm mt-1">Minutes</p>
                      </div>
                      <div class="spin-countdown px-0 col-3">
                        <div class="timer-number">
                          <img src="/assets/images/Timer.png" />
                          <span class="race-sport" id="timer-seconds"></span>
                        </div>
                        <p class="text-white fs-fixed-sm mt-1">Sec</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div id="last-chance" class="container my-2 blink d-none">
                <div class="row d-flex justify-content-center">
                  <div class="col col-8">
                    <img
                      src="/assets/images/Last-Chance.png"
                      class="w-100"
                      alt=""
                    />
                  </div>
                </div>
              </div>
              <!-- <span id="spin-countdown"></span> -->

              <small
                id="limited-container"
                class="text-white text-center my-2 sf-pro-regular fs-fixed-xs"
                >*Limited to Malaysia citizens or permanent residents
                only</small
              >

              <div class="info-wrapper w-100 mt-3">
                <div class="row d-flex justify-content-center">
                  <div class="col col-8">
                    <div class="info flex-column">
                      <h6
                        class="text-blue mt-0 blink sf-pro-heavy fs-fixed-md"
                        id="info-header"
                      >
                        You have (3) Free Spins!
                      </h6>
                      <small
                        class="text-blue sf-pro-semibold mt-2 blink fs-fixed-sm"
                        id="info-body"
                        >Test your luck to win 288% Magnificent</small
                      >
                      <small
                        class="text-blue sf-pro-semibold blink fs-fixed-sm"
                        id="info-welcome"
                        >Welcome Bonus Challenge on 96M!</small
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="w-100 d-flex flex-column align-items-center"
                id="replaceable-container"
              >
                <div
                  id="first-step"
                  class="w-100 d-flex flex-column align-items-center mt-5"
                >
                  <div class="row d-flex justify-content-center">
                    <div
                      class="col-8 d-flex flex-column justify-content-center px-3"
                    >
                      <!-- <div id="dwheel" class="dwheel mt-4"></div> -->
                      <div class="spin-wrapper">
                        <img
                          class="wheel-underlay"
                          src="/assets/images/SpinnerUnderlay.png"
                        />
                        <img class="wheel" src="/assets/images/Spinner-2.png" />
                        <img
                          class="marker"
                          src="/assets/images/SpinnerArrow.png"
                        />
                        <!-- <img class="button" src="button.png" /> -->
                      </div>
                      <button
                        class="text-white orange-theme-btn mt-4 ps-5 pe-5 align-self-center sf-pro-heavy"
                        id="spin"
                      >
                        <small> Spin </small>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- <div
                id="second-step"
                class="d-flex flex-column align-items-center w-75 d-none"
              >
                <small class="text-white mt-3 fw-bold"
                  >Now answer these 3 questions:</small
                >
                <div class="card border-0 mt-4 w-100 card-overlay card-overlay">
                  <div class="card-body d-flex flex-column align-items-center">
                    <div id="question-count" class="rounded-circle">1</div>
                    <small class="text-white mt-3 fw-bold" id="question"
                      >Are you over 18?</small
                    >
                    <div class="d-flex mt-3" id="question-options">
                      <button
                        class="btn bg-gradient-orange rounded-pill py-0 me-2"
                        id="question-yes"
                      >
                        <small class="text-white mt-3 fw-bold">YES</small>
                      </button>
                      <button
                        class="btn bg-gradient-orange rounded-pill py-0"
                        id="question-no"
                      >
                        <small class="text-white mt-3 fw-bold">NO</small>
                      </button>
                    </div>
                  </div>
                </div>
              </div> -->

              <div id="progress" class="w-75 d-none">
                <h5
                  class="text-white text-center fw-bold mt-2"
                >
                  Checking answers, please wait...
                </h5>
                <div class="progress mt-4">
                  <div
                    class="progress-bar bg-warning"
                    role="progressbar"
                    style="width: 0%"
                    aria-valuenow="0"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      var expire = moment(moment().add(3, "m"), "YYYY-DD-MM hh:mm:ss");
      var questionCount = 1;
      var questions = [
        {
          text: "Are you over 18 years old?",
          answer: null,
        },
        {
          text: "Are you a Malaysia citizen?",
          answer: null,
        },
        {
          text: "Are you ready to get FREE Bonus?",
          answer: null,
        },
      ];

      const repeater = setInterval(() => {
        getDiff();
      }, 1000);

      $(document).ready(() => {
        const startProgress = () => {
          const progressBar = $("#progress .progress .progress-bar");
          const progressStat = 0;

          setTimeout(() => {
            progressBar.width("10%");

            setTimeout(() => {
              progressBar.width("40%");

              setTimeout(() => {
                progressBar.width("70%");

                setTimeout(() => {
                  progressBar.width("100%");
                  setTimeout(() => {
                    $("#progress").fadeOut(300, function () {
                      $(this).addClass("d-none");
                      $(
                        ".header-texts, #spin-countdown-container, #limited-container, #last-chance"
                      ).hide();
                      $("#wrapper-bg-image").attr(
                        "src",
                        "/assets/images/Background-3.jpg"
                      );
                      $("#replaceable-container").load(
                        "/spinnerPages/third-step.html"
                      );
                      // $("#third-step").fadeIn(300, function () {
                      //   $(this).removeClass("d-none");
                      // });
                    });
                  }, 1000);
                }, 500);
              }, 1500);
            }, 600);
          }, 1000);
        };

        const onAnswer = (answer = false) => {
          questions[questionCount - 1].answer = answer;

          if (questionCount === 3) {
            // Questions all answered
            $("#second-step").fadeOut(300, function () {
              $(this).addClass("d-none");
            });

            setTimeout(() => {
              $("#progress").fadeIn(300, function () {
                $(this).removeClass("d-none");
              });
              startProgress();
            }, 300);
            console.log(questions);
          } else {
            $("#question").text(questions[questionCount].text);
            $("#question-count").text(questionCount + 1);
            questionCount += 1;
          }
        };

        $(document).on("click", "#question-yes", () => onAnswer(true));
        $(document).on("click", "#question-no", () => onAnswer());

        const getDiff = () => {
          var now = moment();
          // get the difference between the moments
          const diff = expire.diff(now);

          //express as a duration
          const diffDuration = moment.duration(diff);
          const minutes = diffDuration.minutes();
          const seconds = diffDuration.seconds();

          // display
          $("#timer-minutes").text(minutes);
          $("#timer-seconds").text(seconds);

          if (minutes == 0 && seconds == 0) {
            clearInterval(repeater);
            alert("You didn't spin the wheel in time!");
            // TODO: What happens then? perma can't spin? / refresh? / cache based blocked?
            location.reload();
          }
        };

        getDiff();
      });
    </script>
    <!-- <script src="./js/spin.js"></script> -->
    <script src="./js/spin.js"></script>
  </body>
</html>
